@using mopsik_www.ViewModels
@model MapViewModel

@{
    ViewData["Title"] = "Mapa";
}


<!doctype html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://openlayers.org/en/v4.6.5/css/ol.css" type="text/css">
    <style>
        .map {
            height: 100%;
            width: 100%;
        }
    </style>
    <script src="https://openlayers.org/en/v4.6.5/build/ol.js" type="text/javascript"></script>
    <title>OpenLayers example</title>
</head>
<body>
    <div id="map" class="map"></div>
    <script type="text/javascript">
        var feats = [];

        function convertToFloat(x, y) {
            return parseFloat(x.toString() + "." + y.toString());
        }

    </script>
    @foreach (MopViewModel mop in Model.MopsView.Mops) {
        <script type="text/javascript">
            var startMarker = new ol.Feature({
                type: 'icon',
                geometry: new ol.geom.Point(ol.proj.fromLonLat([convertToFloat(@mop.Coordinates.Longitude), convertToFloat(@mop.Coordinates.Latitude)]))
            });

            startMarker.setStyle(new ol.style.Style({
                image: new ol.style.Icon({
                    anchor: [0.5, 1],
                    color: '@mop.Usage.Car.BackgroundColor',
                    crossOrigin: 'anonymous',
                    src: 'images/parking_white_small.png',
                })
            }));
            feats.push(startMarker);
        </script>
     }
        <script type="text/javascript">

        var vectorLayer = new ol.layer.Vector({
            source: new ol.source.Vector({
                features: feats
            }),
        });


        var map = new ol.Map({
            target: 'map',
            loadTilesWhileAnimating: true,
            layers: [
                new ol.layer.Tile({
                    source: new ol.source.OSM()
                }),
                vectorLayer
            ],
            view: new ol.View({
                center: ol.proj.fromLonLat([19.1451, 51.9194]),
                zoom: 6,
                minZoom: 2
            })
        });
    </script>
</body>
</html>